<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Farm Run - –ò–≥—Ä–∞</title>
    <link rel="stylesheet" href="style.css">
    <style>
        #game-ui, #pause-ui, #ad-menu, #ad-video-overlay { 
            position: absolute; inset: 0; background: rgba(0,0,0,0.85); 
            display: flex; flex-direction: column; align-items: center; justify-content: center; 
            z-index: 100; font-family: sans-serif; color: white;
        }
        .hidden { display: none !important; }
        #hud { position: absolute; top: 10px; left: 20px; z-index: 10; color: white; }
        canvas { display: block; background: #fff; border-bottom: 5px solid #000; margin: 0 auto; }
        
        /* –î–∏–∑–∞–π–Ω —Ä–µ–∫–ª–∞–º—ã */
        .ad-option { background: #333; border: 1px solid #555; padding: 15px; margin: 5px; width: 300px; cursor: pointer; border-radius: 8px; display: flex; justify-content: space-between; }
        #ad-video-overlay { background: #000; }
        #video-wrapper { width: 85%; max-width: 850px; aspect-ratio: 16/9; background: #111; }
        #close-ad-btn { position: absolute; top: 20px; right: 20px; width: 50px; height: 50px; border-radius: 50%; border: none; font-size: 24px; cursor: pointer; font-weight: bold; }
        .menu-btn { padding: 12px 30px; cursor: pointer; font-weight: bold; border-radius: 8px; border: none; margin: 10px; }
    </style>
</head>
<body>

    <div id="hud">
        <div id="score-info">–î–∏—Å—Ç–∞–Ω—Ü–∏—è: 0 –º</div>
        <div id="total-coins-display" style="color: gold; font-size: 20px;">–ú–æ–Ω–µ—Ç—ã: 0</div>
        <button onclick="openAdMenu()" style="cursor:pointer; background: #4CAF50; color: white; border:none; padding: 5px 10px; border-radius: 5px;">+ –ë–ï–°–ü–õ–ê–¢–ù–û</button>
    </div>

    <canvas id="gameCanvas"></canvas>

    <div id="ad-menu" class="hidden">
        <h2>–ë–ï–°–ü–õ–ê–¢–ù–´–ï –ú–û–ù–ï–¢–´</h2>
        <div class="ad-option" onclick="startAd(15, 15, '93R2rAgj4pA')"><span>15 —Å–µ–∫</span> <b>+15 üí∞</b></div>
        <div class="ad-option" onclick="startAd(30, 25, '6M1xLM9OO28')"><span>30 —Å–µ–∫</span> <b>+25 üí∞</b></div>
        <div class="ad-option" onclick="startAd(60, 40, 'QXbn6GPdOhw')"><span>60 —Å–µ–∫</span> <b>+40 üí∞</b></div>
        <div class="ad-option" onclick="startAd(120, 80, 'F9zGow9FExc')"><span>120 —Å–µ–∫</span> <b>+80 üí∞</b></div>
        <button class="menu-btn" onclick="closeAdMenu()">–ó–ê–ö–†–´–¢–¨</button>
    </div>

    <div id="ad-video-overlay" class="hidden">
        <div style="margin-bottom: 10px; font-size: 18px;">–†–µ–∫–ª–∞–º–∞: <span id="time-num">--</span> —Å–µ–∫</div>
        <button id="close-ad-btn" class="hidden" onclick="finishAd()">‚úï</button>
        <div id="video-wrapper"></div>
    </div>

    <div id="game-ui" class="hidden">
        <h1 style="color: #ff4444;">–ö–û–ù–ï–¶ –ò–ì–†–´</h1>
        <div id="res-stats" style="font-size: 20px; margin-bottom: 20px;"></div>
        <button class="menu-btn" style="background:#4CAF50; color:white;" onclick="location.reload()">–ò–ì–†–ê–¢–¨ –°–ù–û–í–ê</button>
        <button class="menu-btn" onclick="location.href='index.html'">–í –ú–ï–ù–Æ</button>
    </div>

    <script>
        const canvas = document.getElementById("gameCanvas");
        const ctx = canvas.getContext("2d");
        canvas.width = 800; canvas.height = 250;

        // –ü–ª–∞–≤–Ω—ã–π –ø—Ä—ã–∂–æ–∫: —É–º–µ–Ω—å—à–∏–ª–∏ jump –∏ –≥—Ä–∞–≤–∏—Ç–∞—Ü–∏—é
        const activeSkin = localStorage.getItem('activeSkin') || 'baran';
        const imgPlayer = new Image(); imgPlayer.src = activeSkin + ".png";
        const imgCactus = new Image(); imgCactus.src = "cactus.png";
        
        let isPlaying = true, isPaused = false, distance = 0, sessionMoney = 0;
        let gameSpeed = 5, cacti = [];
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–ª–∞–≤–Ω–æ—Å—Ç–∏: jump –±—ã–ª -13, —Å—Ç–∞–ª -10 (–≤—ã—Å–æ—Ç–∞ –Ω–∏–∂–µ). Grav –±—ã–ª 0.7, —Å—Ç–∞–ª 0.5 (–ø–ª–∞–≤–Ω–µ–µ).
        let dino = { x: 50, y: 200, dy: 0, jump: -10, grav: 0.5, ground: true };

        function loop() {
            if (!isPlaying || isPaused) return;
            ctx.clearRect(0,0, 800, 250);
            
            gameSpeed += 0.0005;
            distance += gameSpeed / 120;

            // –§–∏–∑–∏–∫–∞ –ø—Ä—ã–∂–∫–∞
            dino.dy += dino.grav;
            dino.y += dino.dy;
            if (dino.y > 200) { dino.y = 200; dino.dy = 0; dino.ground = true; }

            if (imgPlayer.complete) ctx.drawImage(imgPlayer, dino.x, dino.y, 50, 50);

            // –ö–∞–∫—Ç—É—Å—ã
            if (Math.random() < 0.01 && (cacti.length === 0 || cacti[cacti.length-1].x < 450)) {
                cacti.push({x: 800, y: 200});
            }

            for (let i = cacti.length-1; i>=0; i--) {
                cacti[i].x -= gameSpeed;
                if (imgCactus.complete) ctx.drawImage(imgCactus, cacti[i].x, cacti[i].y, 40, 50);
                
                if (dino.x < cacti[i].x + 25 && dino.x + 35 > cacti[i].x && dino.y + 40 > cacti[i].y) {
                    isPlaying = false;
                    document.getElementById('res-stats').innerHTML = `–î–∏—Å—Ç–∞–Ω—Ü–∏—è: ${Math.floor(distance)}–º`;
                    document.getElementById('game-ui').classList.remove('hidden');
                    saveCoins();
                }
            }
            
            document.getElementById('total-coins-display').innerText = "–ú–æ–Ω–µ—Ç—ã: " + (parseInt(localStorage.getItem('dinoCoins')||0) + sessionMoney);
            document.getElementById('score-info').innerText = "–î–∏—Å—Ç–∞–Ω—Ü–∏—è: " + Math.floor(distance) + " –º";
            requestAnimationFrame(loop);
        }

        function saveCoins() {
            let c = parseInt(localStorage.getItem('dinoCoins')) || 0;
            localStorage.setItem('dinoCoins', c + sessionMoney);
        }

        window.addEventListener("keydown", e => { 
            if(e.code==="Space" && dino.ground && isPlaying) { 
                dino.dy = dino.jump; 
                dino.ground = false; 
            } 
        });

        // –õ–û–ì–ò–ö–ê –†–ï–ö–õ–ê–ú–´
        let adReward = 0;
        function openAdMenu() { isPaused = true; document.getElementById('ad-menu').classList.remove('hidden'); }
        function closeAdMenu() { document.getElementById('ad-menu').classList.add('hidden'); isPaused = false; requestAnimationFrame(loop); }

        function startAd(sec, reward, id) {
            adReward = reward;
            document.getElementById('ad-menu').classList.add('hidden');
            document.getElementById('ad-video-overlay').classList.remove('hidden');
            document.getElementById('close-ad-btn').classList.add('hidden');
            
            const wrapper = document.getElementById('video-wrapper');
            wrapper.innerHTML = `<iframe width="100%" height="100%" src="https://www.youtube.com/embed/${id}?autoplay=1&controls=0" frameborder="0" allow="autoplay"></iframe>`;
            
            let timeLeft = sec;
            document.getElementById('time-num').innerText = timeLeft;
            let timer = setInterval(() => {
                timeLeft--;
                document.getElementById('time-num').innerText = timeLeft;
                if(timeLeft <= 0) {
                    clearInterval(timer);
                    document.getElementById('close-ad-btn').classList.remove('hidden');
                }
            }, 1000);
        }

        function finishAd() {
            let c = parseInt(localStorage.getItem('dinoCoins')) || 0;
            localStorage.setItem('dinoCoins', c + adReward);
            location.reload();
        }

        loop();
    </script>
</body>
</html>
