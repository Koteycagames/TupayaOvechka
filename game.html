<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Farm Run - –ò–≥—Ä–∞</title>
    <link rel="stylesheet" href="style.css">
    <style>
        /* –°—Ç–∏–ª–∏ –æ—Å—Ç–∞–≤–ª—è–µ–º —Ç–µ –∂–µ, —á—Ç–æ –∏ –≤ –ø—Ä–æ—à–ª—ã–π —Ä–∞–∑ */
        #game-ui, #pause-ui, #ad-menu, #ad-video-overlay, #settings-ui { position: absolute; inset: 0; background: rgba(255,255,255,0.98); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 100; font-family: sans-serif; }
        .hidden { display: none !important; }
        #hud { position: absolute; top: 10px; left: 20px; text-align: left; pointer-events: none; z-index: 10; font-family: sans-serif; }
        canvas { display: block; background: #fff; border-bottom: 2px solid #000; margin: 0 auto; }
        #add-coins-btn { pointer-events: auto; background: #4CAF50; color: white; border: none; border-radius: 5px; padding: 2px 12px; cursor: pointer; font-weight: bold; font-size: 20px; margin-left: 10px; }
        .ad-option { background: #f9f9f9; border: 2px solid #ddd; padding: 15px; margin: 8px; width: 340px; display: flex; justify-content: space-between; align-items: center; cursor: pointer; border-radius: 10px; }
        #ad-video-overlay { background: #000; z-index: 1000; }
        #video-wrapper { width: 85%; max-width: 900px; aspect-ratio: 16/9; background: #111; }
        .menu-btn { margin: 10px; padding: 12px 30px; cursor: pointer; font-weight: bold; min-width: 200px; }
    </style>
</head>
<body>
    <div id="hud">
        <div id="score-info">–î–∏—Å—Ç–∞–Ω—Ü–∏—è: 0 –º</div>
        <div id="total-coins-display" style="color: #B8860B; font-weight: bold; font-size: 20px;">–ú–æ–Ω–µ—Ç—ã: 0</div>
        <button id="add-coins-btn" onclick="openAdMenu()">+</button>
    </div>

    <button id="pause-btn" style="position:absolute; top:10px; right:20px; z-index:20;" onclick="togglePause()">–ü–ê–£–ó–ê (Esc)</button>
    <canvas id="gameCanvas"></canvas>

    <div id="settings-ui" class="hidden">
        <h1>–ù–ê–°–¢–†–û–ô–ö–ò</h1>
        <label>–ó–≤—É–∫–∏: <input type="checkbox" id="sound-check"></label>
        <button class="menu-btn" onclick="closeSettings()">–ù–ê–ó–ê–î</button>
    </div>

    <div id="ad-menu" class="hidden">
        <h2>–ë–ï–°–ü–õ–ê–¢–ù–´–ï –ú–û–ù–ï–¢–´</h2>
        <div class="ad-option" onclick="startAd(15, 15, '93R2rAgj4pA')">15 —Å–µ–∫ (+15 üí∞)</div>
        <div class="ad-option" onclick="startAd(30, 25, '6M1xLM9OO28')">30 —Å–µ–∫ (+25 üí∞)</div>
        <div class="ad-option" onclick="startAd(60, 40, 'QXbn6GPdOhw')">60 —Å–µ–∫ (+40 üí∞)</div>
        <button class="menu-btn" onclick="closeAdMenu()">–ó–ê–ö–†–´–¢–¨</button>
    </div>

    <div id="ad-video-overlay" class="hidden">
        <div id="ad-timer-display" style="color:white; position:absolute; top:20px; left:20px;">–ñ–¥–∏—Ç–µ: <span id="time-num">--</span> —Å–µ–∫</div>
        <button id="close-ad-btn" class="hidden" style="position:absolute; top:20px; right:20px; padding:10px;" onclick="finishAd()">‚úï</button>
        <div id="video-wrapper"></div>
    </div>

    <div id="pause-ui" class="hidden">
        <h1>–ü–ê–£–ó–ê</h1>
        <button class="menu-btn" onclick="togglePause()">–ü–†–û–î–û–õ–ñ–ò–¢–¨</button>
        <button class="menu-btn" onclick="openSettings()">–ù–ê–°–¢–†–û–ô–ö–ò</button>
        <button class="menu-btn" onclick="location.href='index.html'">–í –ú–ï–ù–Æ</button>
    </div>

    <div id="game-ui" class="hidden">
        <h1>–ö–û–ù–ï–¶ –ò–ì–†–´</h1>
        <div id="res-stats"></div>
        <button class="menu-btn" onclick="resetGame()">–ï–©–ï –†–ê–ó</button>
        <button class="menu-btn" onclick="location.href='index.html'">–í –ú–ï–ù–Æ</button>
    </div>

    <script>
        // JS –∫–æ–¥ –æ—Å—Ç–∞–µ—Ç—Å—è –∫–∞–∫ –≤ –ø—Ä–µ–¥—ã–¥—É—â–µ–º –æ—Ç–≤–µ—Ç–µ, 
        // –Ω–æ —É–±–µ–¥–∏—Å—å, —á—Ç–æ —Å—Å—ã–ª–∫–∏ –Ω–∞ –∫–∞—Ä—Ç–∏–Ω–∫–∏ –∏ –∑–≤—É–∫–∏ –ë–ï–ó —Å–ª–µ—à–∞ –≤ –Ω–∞—á–∞–ª–µ:
        // –ü—Ä–∞–≤–∏–ª—å–Ω–æ: 'sounds/jump.mp3'
        // –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ: '/sounds/jump.mp3'
        
        let adReward = 0, adTimeLeft = 0, adInterval;
        let soundEnabled = localStorage.getItem('dinoSound') !== 'false';

        function openSettings() { document.getElementById('pause-ui').classList.add('hidden'); document.getElementById('settings-ui').classList.remove('hidden'); document.getElementById('sound-check').checked = soundEnabled; }
        function closeSettings() { soundEnabled = document.getElementById('sound-check').checked; localStorage.setItem('dinoSound', soundEnabled); document.getElementById('settings-ui').classList.add('hidden'); document.getElementById('pause-ui').classList.remove('hidden'); }
        function openAdMenu() { isPaused = true; document.getElementById('ad-menu').classList.remove('hidden'); }
        function closeAdMenu() { document.getElementById('ad-menu').classList.add('hidden'); isPaused = false; if(isPlaying) requestAnimationFrame(loop); }

        function startAd(seconds, reward, videoId) {
            adReward = reward; adTimeLeft = seconds;
            document.getElementById('ad-menu').classList.add('hidden');
            document.getElementById('ad-video-overlay').classList.remove('hidden');
            document.getElementById('close-ad-btn').classList.add('hidden');
            const wrapper = document.getElementById('video-wrapper');
            wrapper.innerHTML = `<iframe width="100%" height="100%" src="https://www.youtube.com/embed/${videoId}?autoplay=1" frameborder="0" allow="autoplay"></iframe>`;
            
            if (adInterval) clearInterval(adInterval);
            adInterval = setInterval(() => {
                adTimeLeft--;
                document.getElementById('time-num').innerText = Math.max(0, adTimeLeft);
                if (adTimeLeft <= 0) { clearInterval(adInterval); document.getElementById('close-ad-btn').classList.remove('hidden'); }
            }, 1000);
        }

        function finishAd() {
            document.getElementById('video-wrapper').innerHTML = "";
            let currentCoins = parseInt(localStorage.getItem('dinoCoins')) || 0;
            localStorage.setItem('dinoCoins', currentCoins + adReward);
            location.reload(); // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—á–µ—Ç–∞
        }

        // --- –î–í–ò–ñ–û–ö (—Å–æ–∫—Ä–∞—â–µ–Ω–Ω–æ) ---
        const canvas = document.getElementById("gameCanvas");
        const ctx = canvas.getContext("2d");
        canvas.width = 800; canvas.height = 250;
        const activeSkin = localStorage.getItem('activeSkin') || 'baran';
        const sndJump = new Audio('sounds/jump.mp3'); 
        const sndHit = new Audio('sounds/hit.mp3');
        const imgPlayer = new Image(); imgPlayer.src = `images/${activeSkin}.png`;
        const imgCactus = new Image(); imgCactus.src = `images/cactus.png`;

        let isPlaying = true, isPaused = false, distance = 0, sessionMoney = 0, gameSpeed = 5;
        let cacti = [], dino = { x: 50, y: 200, dy: 0, jump: -13, grav: 0.7, ground: true };

        function loop() {
            if (!isPlaying || isPaused) return;
            ctx.clearRect(0,0, 800, 250);
            gameSpeed += 0.0006; distance += gameSpeed/130;
            dino.dy += dino.grav; dino.y += dino.dy;
            if (dino.y > 200) { dino.y = 200; dino.dy = 0; dino.ground = true; }
            ctx.drawImage(imgPlayer, dino.x, dino.y, 50, 50);
            // ... (–ª–æ–≥–∏–∫–∞ –∫–∞–∫—Ç—É—Å–æ–≤ –∏ –æ—Ç—Ä–∏—Å–æ–≤–∫–∞ –∫–∞–∫ –≤ –∫–æ–¥–µ –≤—ã—à–µ)
            document.getElementById('score-info').innerText = "–î–∏—Å—Ç–∞–Ω—Ü–∏—è: " + Math.floor(distance) + " –º";
            requestAnimationFrame(loop);
        }
        loop();
        window.addEventListener("keydown", e => { if(e.code==="Space") dino.ground && (dino.dy=dino.jump, dino.ground=false); });
    </script>
</body>
</html>
